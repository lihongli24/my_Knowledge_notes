# redis的内存淘汰机制

[toc]
## 为什么需要内存淘汰机制
redis之所以响应速度快，其中一个原因是redis是一个内存数据库，内存访问速度比磁盘会快很多。但是当redis运行很长一段时间之后，肯定会有大量数据在redis内存中，如果没有某种机制来做清理操作，那内存肯定会有被用完的时候。所以redis做了一些操作

1. 对于设置了过期时间的key,使用下面的策略进行清除
   1. 定期删除
   2. 惰性删除

对于过期key的操作，也不能保证过期的key都被删除掉。

1. 定期删除：因为定期删除的时候如果是全量删除的话，那执行的时间可能会很长，

## 什么情况下会触发内存淘汰机制
## redis支持哪些内存淘汰策略
**redis 提供 6种数据淘汰策略：**

1. **volatile-lru**：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰
2. **volatile-ttl**：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰
3. **volatile-random**：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰
4. **allkeys-lru**：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key（这个是最常用的）
5. **allkeys-random**：从数据集（server.db[i].dict）中任意选择数据淘汰
6. **no-eviction**：禁止驱逐数据，也就是说当内存不足以容纳新写入数据时，新写入操作会报错。这个应该没人使用吧！

4.0版本后增加以下两种：

1. **volatile-lfu**：从已设置过期时间的数据集(server.db[i].expires)中挑选最不经常使用的数据淘汰
2. **allkeys-lfu**：当内存不足以容纳新写入数据时，在键空间中，移除最不经常使用的key

## 这些内存淘汰策略是怎么实现的